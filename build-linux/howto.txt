
# Linux Build Instructions

These instructions assume you're running this on a Mac with Vagrant installed,
and that the project directory ends up mounted in the VM at `/vagrant`. (this
should happen automatically)

## Ubuntu

Dev Setup: (one-time for your development Mac)

    gem install fpm

Building the .deb:

    cd build-linux/
    sh make.sh deb

Install & test the .deb:

    vagrant ssh agent-zabbix-ubuntu1004 # or agent-zabbix-ubuntu1204

    sudo apt-get install pdagent
 
    sudo dpkg -i /vagrant/build-linux/target/pdagent-integrations_0.1_all.deb

    /usr/share/pdagent-integrations/bin/pd-zabbix  # should run but fail with an error


Uninstall & test cleanup:

    sudo apt-get --yes remove pdagent-integrations

    # rerun the test commands to ensure files are gone


## CentOS / RHEL

Dev Setup: (one-time for the CentOS VM)

    vagrant up agent-minimal-centos65
    vagrant ssh agent-minimal-centos65

    sudo yum install rpm-build ruby-devel rubygems
    sudo gem install fpm

Building the .rpm:

    vagrant ssh agent-minimal-centos65

    cd
    rm -fr pdagent-integrations
    cp -r /vagrant pdagent-integrations
    cd pdagent-integrations/build-linux/
    sh make.sh rpm

Install & test the .rpm:

    sudo yum install pdagent

    sudo rpm -i target/pdagent-integrations-0.1-1.noarch.rpm

    /usr/share/pdagent-integrations/bin/pd-zabbix  # should run but fail with an error

Uninstall & test cleanup:

    sudo rpm -e pdagent-integrations

    # rerun the test commands to ensure files are gone

